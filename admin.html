<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPL Admin Panel</title>
<style>
body{font-family:sans-serif;margin:0;padding:0;background:#f0f0f0;}
.container{max-width:900px;margin:20px auto;padding:20px;background:#fff;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.2);}
header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;background:#333545;color:#fff;padding:10px;border-radius:10px 10px 0 0;}
header h3{margin:0;font-size:16px;}
header button{padding:6px 12px;background:#f84464;color:#fff;border:none;border-radius:5px;cursor:pointer;margin-top:5px;}
header button:hover{background:#c4242b;}
form input,form button,form label{padding:10px;margin:5px 0;border-radius:5px;border:1px solid #ccc;font-size:14px;width:100%;box-sizing:border-box;}
form button{background:#f84464;color:#fff;border:none;cursor:pointer;}
form button:hover{background:#c4242b;}
table{width:100%;border-collapse:collapse;margin-top:20px;font-size:12px;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
img.preview{width:50px;height:50px;object-fit:contain;border-radius:5px;}
button.edit{background:#4caf50;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:12px;}
button.edit:hover{background:#388e3c;}
button.delete{background:#f44336;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:12px;}
button.delete:hover{background:#c4242b;}
#loginBox{background:#fff;padding:20px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.2);width:90%;max-width:350px;margin:50px auto;text-align:center;}
#loginBox input{width:100%;padding:10px;margin:10px 0;border-radius:6px;border:1px solid #ccc;}
#loginBox button{width:100%;padding:11px;background:#f84464;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:16px;}
#loginBox button:hover{background:#c4242b;}
</style>
</head>
<body>

<div id="loginBox">
<h2>Admin Login</h2>
<input type="text" id="username" placeholder="Phone / Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
<p style="font-size:12px;color:#666;margin-top:10px;">Demo: <strong>7627055204</strong> / <strong>Pooja2005</strong></p>
</div>

<div class="container" id="dashboard" style="display:none;">
<header>
<div style="display:flex;align-items:center;gap:10px;">
<img id="headerLogo" src="" alt="Logo" style="height:40px;display:none;border-radius:5px;">
<h3>Admin Dashboard - <span id="adminUser"></span></h3>
</div>
<button onclick="logout()">Logout</button>
</header>

<h2>Update Logo</h2>
<form id="logoForm">
<label>Upload Logo Image:</label>
<input type="file" id="logoInput" accept="image/*">
<img id="logoPreview" class="preview" style="display:none;">
<button type="submit">Save Logo</button>
</form>

<h2>Update Banner</h2>
<form id="bannerForm">
<label>Upload Banner Image:</label>
<input type="file" id="bannerInput" accept="image/*">
<img id="bannerPreview" class="preview" style="display:none;">
<button type="submit">Save Banner</button>
</form>

<h2>Manage Matches</h2>
<form id="matchForm">
<input type="text" id="teams" placeholder="Team1 vs Team2" required>
<input type="date" id="date" required>
<input type="time" id="time" required>
<input type="text" id="stadium" placeholder="Stadium" required>

<label>Team1 Image (Upload or URL):</label>
<input type="file" id="img1_file" accept="image/*" onchange="previewImage(this, 'preview1')">
<input type="text" id="img1_url" placeholder="Paste Image URL for Team 1">

<label>Team2 Image (Upload or URL):</label>
<input type="file" id="img2_file" accept="image/*" onchange="previewImage(this, 'preview2')">
<input type="text" id="img2_url" placeholder="Paste Image URL for Team 2">

<img id="preview1" class="preview" style="display:none;">
<img id="preview2" class="preview" style="display:none;">
<button type="submit">Save Match</button>
</form>

<table>
<thead>
<tr>
<th>#</th><th>Teams</th><th>Date</th><th>Time</th><th>Stadium</th><th>Team1 Img</th><th>Team2 Img</th><th>Actions</th>
</tr>
</thead>
<tbody id="matchesTable"></tbody>
</table>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, get, child, remove, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  databaseURL: "https://pl-project-f9be7-default-rtdb.firebaseio.com"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const ADMIN_USER = "7627055204", ADMIN_PASS = "Pooja2005";
let editIndex = -1;
let matches = [];

// Login / Logout
function login() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  if (u === ADMIN_USER && p === ADMIN_PASS) {
    localStorage.setItem("isAdmin","true");
    localStorage.setItem("adminUser",ADMIN_USER);
    showDashboard();
  } else alert("Invalid username or password");
}
function logout() {
  localStorage.removeItem("isAdmin");
  localStorage.removeItem("adminUser");
  document.getElementById("dashboard").style.display = "none";
  document.getElementById("loginBox").style.display = "block";
}

// Utility: File to Base64
function toBase64(file) {
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onload = ()=>resolve(reader.result);
    reader.onerror = (err)=>reject(err);
    reader.readAsDataURL(file);
  });
}

// Preview Image
function previewImage(input, previewId) {
  const preview = document.getElementById(previewId);
  if(input.type==='file' && input.files[0]){
    const reader = new FileReader();
    reader.onload = ()=>{preview.src = reader.result; preview.style.display="inline-block";};
    reader.readAsDataURL(input.files[0]);
  } else if(input.type==='text' && input.value.trim()){
    preview.src = input.value.trim();
    preview.style.display="inline-block";
  }
}

// Render Matches Table
function renderTable(){
  const tableBody = document.getElementById("matchesTable");
  tableBody.innerHTML = "";
  matches.forEach((m,i)=>{
    tableBody.innerHTML += `<tr>
      <td>${i+1}</td>
      <td>${m.teams}</td>
      <td>${m.date}</td>
      <td>${m.time}</td>
      <td><small>${m.stadium}</small></td>
      <td><img src="${m.img1||'placeholder'}" class="preview"></td>
      <td><img src="${m.img2||'placeholder'}" class="preview"></td>
      <td>
        <button class="edit" onclick="editMatch(${i})">Edit</button>
        <button class="delete" onclick="deleteMatch(${i})">Delete</button>
      </td>
    </tr>`;
  });
}

// Load Matches from Firebase
async function loadMatches(){
  const dbRef = ref(db);
  try{
    const snapshot = await get(child(dbRef,"matches"));
    if(snapshot.exists()){matches = Object.values(snapshot.val()); renderTable(); }
  } catch(e){console.error(e);}
}

// Save Match to Firebase
async function saveMatch(e){
  e.preventDefault();
  const teams = document.getElementById("teams").value.trim();
  const date = document.getElementById("date").value;
  const time = document.getElementById("time").value;
  const stadium = document.getElementById("stadium").value.trim();
  if(!teams || !date || !time || !stadium){ alert("Fill all fields"); return; }

  let img1=editIndex>=0?matches[editIndex].img1:"";
  let img2=editIndex>=0?matches[editIndex].img2:"";

  const img1Url = document.getElementById("img1_url").value.trim();
  const img1File = document.getElementById("img1_file").files[0];
  if(img1Url){ img1 = img1Url; } else if(img1File){ img1 = await toBase64(img1File); }

  const img2Url = document.getElementById("img2_url").value.trim();
  const img2File = document.getElementById("img2_file").files[0];
  if(img2Url){ img2 = img2Url; } else if(img2File){ img2 = await toBase64(img2File); }

  const match = {teams,date,time,stadium,img1,img2};

  if(editIndex>=0){
    const key = Object.keys(await get(ref(db,"matches")).then(s=>s.val()))[editIndex];
    await update(ref(db,"matches/"+key),match);
    editIndex = -1;
  } else {
    await set(ref(db,"matches/"+Date.now()),match);
  }

  document.getElementById("matchForm").reset();
  document.getElementById("preview1").style.display = "none";
  document.getElementById("preview2").style.display = "none";
  loadMatches();
  alert("Match saved successfully!");
}

// Edit Match
function editMatch(index){
  const m = matches[index];
  document.getElementById("teams").value = m.teams;
  document.getElementById("date").value = m.date;
  document.getElementById("time").value = m.time;
  document.getElementById("stadium").value = m.stadium;
  document.getElementById("img1_url").value = m.img1.startsWith("http")?m.img1:"";
  document.getElementById("img2_url").value = m.img2.startsWith("http")?m.img2:"";
  document.getElementById("preview1").src = m.img1;
  document.getElementById("preview2").src = m.img2;
  document.getElementById("preview1").style.display = "inline-block";
  document.getElementById("preview2").style.display = "inline-block";
  editIndex = index;
}

// Delete Match
async function deleteMatch(index){
  if(!confirm("Are you sure to delete this match?")) return;
  const keys = Object.keys((await get(ref(db,"matches"))).val());
  await remove(ref(db,"matches/"+keys[index]));
  loadMatches();
}

// Banner & Logo Logic
const bannerInput=document.getElementById("bannerInput");
const bannerPreview=document.getElementById("bannerPreview");
const logoInput=document.getElementById("logoInput");
const logoPreview=document.getElementById("logoPreview");
const headerLogo=document.getElementById("headerLogo");

bannerInput.addEventListener("change",()=>{ if(bannerInput.files[0]){ toBase64(bannerInput.files[0]).then(data=>bannerPreview.src=data); bannerPreview.style.display="inline-block";}});
document.getElementById("bannerForm").addEventListener("submit",async e=>{
  e.preventDefault();
  if(bannerInput.files[0]){ const data = await toBase64(bannerInput.files[0]); await set(ref(db,"banner"),{url:data}); alert("Banner saved!"); } else alert("Select an image"); });

logoInput.addEventListener("change",()=>{ if(logoInput.files[0]){ toBase64(logoInput.files[0]).then(data=>logoPreview.src=data); logoPreview.style.display="inline-block";}});
document.getElementById("logoForm").addEventListener("submit",async e=>{
  e.preventDefault();
  if(logoInput.files[0]){ const data = await toBase64(logoInput.files[0]); await set(ref(db,"logo"),{url:data}); headerLogo.src=data; headerLogo.style.display="inline-block"; alert("Logo saved!"); } else alert("Select an image"); });

// Load Banner & Logo
async function loadBannerLogo(){
  const bannerSnap = await get(ref(db,"banner")); if(bannerSnap.exists()){bannerPreview.src=bannerSnap.val().url; bannerPreview.style.display="inline-block";}
  const logoSnap = await get(ref(db,"logo")); if(logoSnap.exists()){logoPreview.src=logoSnap.val().url; headerLogo.src=logoSnap.val().url; headerLogo.style.display="inline-block";}
}

// Show Dashboard
function showDashboard(){
  document.getElementById("loginBox").style.display="none";
  document.getElementById("dashboard").style.display="block";
  document.getElementById("adminUser").textContent = localStorage.getItem("adminUser");
  loadMatches();
  loadBannerLogo();
}

// Initialize
document.addEventListener("DOMContentLoaded",()=>{ if(localStorage.getItem("isAdmin")==="true") showDashboard(); document.getElementById("matchForm").addEventListener("submit",saveMatch);});
</script>

</body>
</html>
