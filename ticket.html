<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ultra-Realistic IPL Ticket</title>
<style>
:root{
  --page-w:980px;
  --paper:#fffdf9;
  --muted:#666;
  --blue:#0b81d1;
  --blue-deep:#0468a8;
}
body {
  font-family:sans-serif;
  margin:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:#e0e0e0;
  padding:10px;
}
.ticket {
  width:95%;
  max-width:980px;
  background: var(--paper);
  border-radius:12px;
  box-shadow:0 20px 40px rgba(0,0,0,0.35), inset 0 2px 12px rgba(0,0,0,0.08);
  position:relative;
  overflow:hidden;
  padding:20px;
  display:flex;
  flex-direction:column;
  background-image:
    linear-gradient(transparent 0, rgba(0,0,0,0.02) 1px),
    linear-gradient(90deg, rgba(0,0,0,0.01) 1px, transparent 1px);
  background-size:100% 8px, 8px 100%;
  clip-path: polygon(5% 0%, 95% 0%, 100% 5%, 100% 95%, 95% 100%, 5% 100%, 0% 95%, 0% 5%);
}
.ticket::after{
  content:"";
  position:absolute; top:0; left:0; right:0; bottom:0;
  pointer-events:none;
  background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(0,255,255,0.04) 50%, rgba(255,255,0,0.04) 100%);
  mix-blend-mode:overlay;
  animation: shimmer 4s infinite linear;
}
@keyframes shimmer {0%{background-position:0% 0%;}100%{background-position:200% 0%;}}
.meta-left, .meta-right{position:absolute; font-size:12px; color:var(--muted); line-height:1.12;}
.meta-left{left:18px; top:16px; text-align:left;}
.meta-right{right:16px; top:16px; text-align:right;}
.meta-left b, .meta-right b{display:block; font-weight:900; color:#111; font-size:13px;}
.top-center-price{position:absolute; left:50%; transform:translateX(-50%); top:14px; font-size:12px; color:var(--muted); text-align:center; line-height:1.15;}
.top-center-price b{display:block; font-weight:900; color:#111; margin-top:3px;}
.main{display:flex; gap:14px; align-items:stretch; padding:36px 20px 18px 20px; position:relative;}
.left{width:270px; display:flex; flex-direction:column; align-items:center; gap:9px;}
.left .biglogo{width:100%; min-height:120px; display:flex; align-items:center; justify-content:center; background:linear-gradient(145deg,#fdfdfd,#f0f0f0); border-radius:8px; overflow:hidden; box-shadow: inset 0 2px 6px rgba(0,0,0,0.1), 0 4px 12px rgba(0,0,0,0.2);}
.left .biglogo img{width:100%; height:auto; object-fit:contain;}
.left .teamname{font-weight:800; color:#222; font-size:14px; text-align:center; letter-spacing:0.2px;}
.center{flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; position:relative;}
.center .small-logos{display:flex; gap:12px;}
.center .small-logos .box{width:96px; height:34px; border-radius:6px; background:linear-gradient(145deg,#fafafa,#f0f0f0); display:flex; align-items:center; justify-content:center; overflow:hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);}
.center .small-logos .box img{max-width:84%; max-height:84%;}
.center .matchno{font-weight:900; font-size:15px; color:#111;}
.center .teams{margin-top:2px; font-weight:800; font-size:15px; text-align:center;}
.center .date{margin-top:6px; font-size:13.5px; color:var(--muted); text-align:center;}
.center .stadium{margin-top:4px; font-size:13px; color:var(--muted); text-align:center;}
.gate-ghost{position:absolute; right:22%; top:-8%; font-size:84px; font-weight:900; color:rgba(0,0,0,0.05); pointer-events:none; transform: translateY(10%); text-shadow:2px 2px 4px rgba(0,0,0,0.15);}
.right{width:250px; display:flex; flex-direction:column; align-items:center; gap:9px; padding-left:12px; border-left:1px dashed rgba(0,0,0,0.15); background:linear-gradient(90deg, rgba(255,255,255,0.6), rgba(250,250,250,0.95));}
.right .mini{width:130px; height:58px; border-radius:6px; background:linear-gradient(145deg,#fafafa,#f0f0f0); display:flex; align-items:center; justify-content:center; overflow:hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);}
.right .mini img{max-width:100%; max-height:100%; object-fit:contain;}
.right .mini-text{font-size:13px; color:var(--muted); text-align:center; line-height:1.05;}
.right .tot{ font-weight:900; color:#111; font-size:13.5px; margin-top:4px;}
.bottom{margin-top:14px; background: linear-gradient(180deg, var(--blue), var(--blue-deep)); color:#fff; border-radius:6px; padding:12px 14px; display:flex; gap:10px; align-items:center; justify-content:space-between; font-weight:900; box-shadow: inset 0 -6px 12px rgba(0,0,0,0.2);}
.bottom .cell{flex:1; text-align:center; font-size:19px;}
.bottom .cell small{ display:block; font-size:11px; font-weight:700; opacity:0.95; margin-bottom:6px;}
.perfor{position:absolute; right:252px; top:58px; height:190px; pointer-events:none; background:repeating-linear-gradient(to bottom, rgba(0,0,0,0.15) 0 2px, transparent 2px 6px); width:3px; border-radius:50%;}
.notch{position:absolute; left:8px; bottom:78px; width:18px; height:18px; border-radius:50%; background:var(--blue); box-shadow:0 2px 6px rgba(0,0,0,0.35);}
@media (max-width:900px){
  .main{flex-direction:column; padding:20px;}
  .left, .center, .right{width:100%; text-align:center;}
  .left .biglogo{width:80%; height:120px; margin:0 auto;}
  .right{display:none;}
  .bottom{flex-direction:column; gap:6px; font-size:16px;}
  .gate-ghost{display:none;}
}
#downloadBtn{
  margin-top:20px; padding:12px 20px; font-size:16px; font-weight:700; background:#4caf50; color:#fff; border:none; border-radius:10px; cursor:pointer;
}
</style>
</head>
<body>

<div class="ticket" id="ticket">
  <div class="meta-left"><b id="sr-left">000001</b><b id="roll-left">001</b><div id="code-left">A000001</div></div>
  <div class="top-center-price"><b>Rs.<span id="totalPrice">0</span></b></div>
  <div class="meta-right"><b id="sr-right">000001</b><b id="roll-right">001</b><div id="code-right">A000001</div></div>

  <div class="main">
    <div class="left">
      <div class="biglogo"><img id="leftLogo" src="" alt="Team Logo"></div>
      <div class="teamname" id="leftTeam"></div>
    </div>
    <div class="center">
      <div class="small-logos">
        <div class="box"><img id="iplLogo" src="https://upload.wikimedia.org/wikipedia/commons/3/3a/Indian_Premier_League_logo.svg" alt="IPL"></div>
        <div class="box"><img id="oppSmallLogo" src="" alt="Opponent Logo"></div>
      </div>
      <div class="matchno" id="matchNo"></div>
      <div class="teams" id="teamsText"></div>
      <div class="date" id="dateText"></div>
      <div class="stadium" id="stadText"></div>
      <div class="gate-ghost" id="gateGhost">1</div>
    </div>
    <div class="right">
      <div class="mini"><img id="miniLogo" src="" alt="mini"></div>
      <div class="mini-text" id="miniText"></div>
      <div class="tot">Rs.<span id="totalPrice2">0</span></div>
    </div>
    <div class="perfor"></div>
  </div>

  <div class="notch"></div>

  <div class="bottom">
    <div class="cell"><small>ENTRY FROM</small><span id="entryFrom"></span></div>
    <div class="cell"><small>STAIRCASE</small><span id="staircase"></span></div>
    <div class="cell"><small>BLOCK/SEAT</small><span id="seat"></span></div>
    <div class="cell"><small>GATE</small><span id="gate"></span></div>
  </div>
</div>

<button id="downloadBtn">Download Ticket</button>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
// Default logo for safety
const DEFAULT_LOGO = "https://iili.io/K8L5Ots.jpg";

// Fetch ticket data
const ticketData = JSON.parse(localStorage.getItem('finalTicket'));

if(!ticketData || !ticketData.matchDetails){
  alert("❌ Ticket data not found! Please ensure payment was completed.");
  // Redirect to home if data is missing
  window.location.href="index.html"; 
}

const match = ticketData.matchDetails;
const teamsArray = match.teams.split(' vs ');
const team1Name = teamsArray[0] || 'Team 1';
const team2Name = teamsArray[1] || 'Team 2';
// UTR और Booking ID से एक यूनिक ID बनाना
const uniqueTicketId = (ticketData.bookingId || 'IPL0000') + (ticketData.utr ? ticketData.utr.slice(-4) : '0000');


// --- Ticket Population ---

// 1. Header Metadata
document.getElementById('totalPrice').textContent = ticketData.total;
document.getElementById('totalPrice2').textContent = ticketData.total;
document.getElementById('sr-left').textContent = uniqueTicketId;
document.getElementById('sr-right').textContent = uniqueTicketId;
document.getElementById('roll-left').textContent = ticketData.qty;
document.getElementById('roll-right').textContent = ticketData.qty;
document.getElementById('code-left').textContent = ticketData.seatType.substring(0, 3).toUpperCase() + '-' + ticketData.qty;
document.getElementById('code-right').textContent = ticketData.seatType.substring(0, 3).toUpperCase() + '-' + ticketData.qty;


// 2. Main Center Content
// Logos (img1/img2 from matchDetails)
document.getElementById('leftLogo').src = match.img1 || DEFAULT_LOGO;
document.getElementById('leftTeam').textContent = team1Name;
document.getElementById('oppSmallLogo').src = match.img2 || DEFAULT_LOGO;
document.getElementById('matchNo').textContent = 'TICKET FOR: ' + ticketData.seatType.toUpperCase();
document.getElementById('teamsText').textContent = match.teams;
document.getElementById('dateText').textContent = `${match.date} | ${match.time || '—'}`;
document.getElementById('stadText').textContent = match.stadium;
document.getElementById('miniLogo').src = match.img1 || DEFAULT_LOGO;
document.getElementById('miniText').textContent = team1Name + ' vs ' + team2Name;


// 3. Bottom Band (Randomized/Dummy Data for Seat/Gate)
const GATE = (Math.floor(Math.random() * 5) + 1).toString();
const STAIRCASE = (Math.floor(Math.random() * 8) + 1).toString();
const SEAT_NO = Math.floor(Math.random() * 50) + 1;
const BLOCK_LETTER = String.fromCharCode(65 + Math.floor(Math.random() * 5)); // A, B, C, D, E

document.getElementById('gateGhost').textContent = GATE;
document.getElementById('entryFrom').textContent = 'GATE ' + GATE;
document.getElementById('staircase').textContent = STAIRCASE;
document.getElementById('seat').textContent = `${BLOCK_LETTER} / ${SEAT_NO}`; // Block/Seat No
document.getElementById('gate').textContent = GATE;


// --- Download Functionality ---

document.getElementById('downloadBtn').addEventListener('click', () => {
    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    
    // html2canvas के लोड होने का इंतज़ार करें
    if (typeof html2canvas === 'undefined') {
        alert("Please wait a moment while the download tools load.");
        return;
    }
    
    alert("🎉 Congratulations! Your ticket is ready to download.");
    
    // Ticket div को canvas में बदलना
    html2canvas(document.getElementById('ticket'), { scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = `IPL_Ticket_${uniqueTicketId}.png`;
        link.click();
    });
});

// Load html2canvas script
const script = document.createElement('script');
script.src = "https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js";
document.head.appendChild(script);

// Ensure the seat label is correct for the ticket layout
document.querySelector('#seat').previousElementSibling.innerHTML = 'BLOCK/SEAT';

</script>

</body>
</html>
